## 2026-02-19 — version 1.0.11

### Features added

**Plugin mux status bar hook (`mux_status` capability)**
- Plugins can now contribute text to the centre of the mux status bar by
  declaring the `mux_status` capability and handling the `mux_status` argument.
- The mux polls each capable plugin binary roughly once per second while mux is
  active and displays the joined output centred between the fixed `vlsh mux`
  (left) and pane-count (right) labels. Multiple plugins' outputs are separated
  by two spaces. The text is truncated to fit if the terminal is too narrow.
- `has_mux_status bool` added to the `Plugin` struct in `plugins/plugins.v`;
  parsed in `plugins.load()` alongside the existing capability tokens.
- New `mux_status_binaries(loaded []Plugin) []string` helper in
  `plugins/plugins.v` returns the binary paths of all `mux_status`-capable
  plugins, ready to be passed to `mux.enter()`.
- `mux.enter()` signature changed to `enter(status_providers []string)`.
  The providers are stored on `Mux` and polled via the new
  `refresh_status_text()` method in `mux/mux.v`.
- `render_statusbar_sb`, `render_all`, and `render_dirty` in `mux/render.v`
  each gain a `status_text string` parameter; the status bar renders the text
  centred in the fill region when it is non-empty.
- `vlsh.v` passes `plugins.mux_status_binaries(loaded_plugins)` to
  `mux.enter()` so the live plugin list is always used.
- `examples/hello_plugin.v` updated: `mux_status` added to the capabilities
  block and a matching handler stub prints `[ example plugin ]`.
- Version bumped to `1.0.11` in `vlsh.v` and `v.mod`.
- Packages rebuilt: `builds/vlsh_1.0.11_amd64.deb` and
  `builds/vlsh_1.0.11_amd64_linux`.

---

## 2026-02-19 — version 1.0.10

### Changes

**`share` command extracted into a plugin**
- The `share <file>` built-in command has been removed from the main shell
  binary and moved to a standalone plugin (`plugins/share.v` in the official
  plugin repository at https://github.com/vlshcc/plugins).
- The `pub fn share()` function and its `net.http` import have been removed
  from `cmds/cmds.v`. The `'share'` dispatch case has been removed from
  `vlsh.v`. The `share` entry has been removed from the `help` listing and
  `help_sub` in `cmds/cmds.v`.
- To restore the command: `plugins install share` then `plugins reload`.
- Version bumped to `1.0.10` in `vlsh.v` and `v.mod`.
- Packages rebuilt: `builds/vlsh_1.0.10_amd64.deb` and
  `builds/vlsh_1.0.10_amd64_linux`.

---

## 2026-02-19 — version 1.0.9

### Features added

**Remote plugin repository support**
- New `plugins remote` / `plugins remote list` subcommand lists all plugins
  available in the official repository at https://github.com/vlshcc/plugins.
  Already-installed plugins are shown in bold with an `[installed]` tag.
- `plugins remote search <query>` filters the remote list by name substring
  (case-insensitive).
- `plugins install <name>` downloads the named `.v` source file from the remote
  repository into `~/.vlsh/plugins/` without requiring git, curl, or any
  external tooling. After installing, run `plugins reload` to activate it.
- `plugins delete <name>` removes a locally installed plugin's source file and
  compiled binary, and immediately unloads it from the active session.
- Implemented in `plugins/plugins.v`: `remote_available() ![]string`,
  `install(name string) !`, `delete_plugin(name string) !`. Uses
  `https://api.github.com/repos/vlshcc/plugins/contents` for listing and
  `https://raw.githubusercontent.com/vlshcc/plugins/main/<name>.v` for
  downloads.

### Other changes

**Removed `__global` — `-enable-globals` flag no longer required**
- The `g_loaded` global variable and `set_loaded()` function have been removed
  from `plugins/plugins.v`.
- `completions()` now accepts `[]Plugin` as an explicit first parameter instead
  of reading from module-level global state.
- The `completion_callback` in `vlsh.v` is now a closure capturing
  `mut loaded_plugins` by reference, so tab completions always reflect the
  current plugin list with no global state.
- `v run .` and `v .` now work without any extra flags.
- `build_deb.sh` updated: `-enable-globals` removed from the compile step.
- Version bumped to `1.0.9` in `vlsh.v` and `v.mod`.
- Packages rebuilt: `builds/vlsh_1.0.9_amd64.deb` and
  `builds/vlsh_1.0.9_amd64_linux`.

---

## 2026-02-19 — version 1.0.8

### Bugs fixed

**Glob expansion failed for paths containing `../` or `./`**
- `cp ../plugins/* .` (and similar patterns with relative path components)
  passed the literal `*` to the external command instead of expanding it.
- Root cause: V's `os.glob` walks directory entries internally and explicitly
  skips `.` and `..` entries, so any glob pattern whose directory component
  contains `../` or `./` always returned zero matches.
- Fixed in `utils/utils.v` (`glob_expand`): when the pattern contains a `/`,
  the directory component is now resolved to an absolute path via
  `os.real_path()` before `os.glob` is called.  The filename wildcard is
  kept as-is, so `../plugins/*` becomes `/home/user/repos/plugins/*` and
  matches correctly.

### Other changes

- Version bumped to `1.0.8` in `vlsh.v` and `v.mod`.
- Packages rebuilt: `builds/vlsh_1.0.8_amd64.deb` and
  `builds/vlsh_1.0.8_amd64_linux`.

---

## 2026-02-19 — version 1.0.7

### Features added

**Mux scrollback buffer**
- Each mux pane now retains up to 1 000 lines of scrollback history. Rows that
  scroll off the top of the visible area are saved into a per-pane ring buffer
  (`scrollback [][]Cell`, max `scrollback_max = 1000` rows) in `mux/pane.v`.
- `view_scroll_up(n int)` / `view_scroll_down(n int)` methods move the
  viewport into or back out of the scrollback buffer.
- While scrolled back, the view is kept anchored: every new line of output
  increments `scroll_offset` so the same historical rows stay on screen.
  When the buffer reaches capacity the oldest row is silently dropped (one-row
  drift is accepted at that point).
- An orange indicator (`-N lines`) is rendered in the top-right corner of the
  pane whenever `scroll_offset > 0`, so the user always knows they are in
  scroll view. Implemented in `render_pane_sb` in `mux/render.v`.
- Text selection highlighting is suppressed while in scroll view (selection
  coordinates are relative to the live grid only).

**Mux scroll controls**
- **Mouse wheel** — scroll wheel up/down events (SGR `Cb=64` / `Cb=65`)
  are now intercepted in `mux/input.v` and mapped to the new
  `scroll_pane_up` / `scroll_pane_down` `MuxAction` variants. Mouse wheel
  always scrolls the active pane regardless of prefix state.
- **Keyboard** — `Ctrl+V` + `PageUp` (`\x1b[5~`) / `Ctrl+V` + `PageDown`
  (`\x1b[6~`) also scroll the active pane. Handled in the `prefix_wait` branch
  of `InputHandler.handle()`.
- Scrolling is wired to the new `do_scroll_pane(up bool)` helper in
  `mux/mux.v` which moves the active pane by 5 lines per step.

### Bugs fixed

**SSH hostname completion plugin failed to compile**
- `hosts_from_config() + hosts_from_known_hosts()` used the `+` operator on
  two `[]string` values, which V does not support.
- Fixed in `~/.vlsh/plugins/ssh_hosts.v` by replacing the expression with an
  explicit `<<` append:
  ```v
  mut combined := hosts_from_config()
  combined << hosts_from_known_hosts()
  ```

### Other changes

- Version bumped to `1.0.7` in `vlsh.v` and `v.mod`.
- `help mux` updated with the new scroll keybindings and a note about the
  1 000-line scrollback buffer.
- `README.md` mux section updated: feature bullet extended, keybindings table
  includes `PageUp`, `PageDown`, and mouse wheel rows, and a paragraph
  describing the scroll indicator was added.
- **Disclaimer** added to `README.md`: the creator is not liable for any
  damage, data loss, or other consequence from using vlsh or its plugins.
- Packages rebuilt: `builds/vlsh_1.0.7_amd64.deb` and
  `builds/vlsh_1.0.7_amd64_linux`.

---

## 2026-02-19 — version 1.0.6

### Features added

**`plugins enable all` / `plugins disable all`**
- `plugins enable all` enables every plugin in `~/.vlsh/plugins/` in one command
  by removing the disabled list entirely, then reloads all plugins.
- `plugins disable all` writes every available plugin name to the disabled list
  and immediately clears the in-memory loaded set, so no plugins run for the
  rest of the session.
- The existing `plugins enable <name>` and `plugins disable <name>` subcommands
  are unchanged; `all` is simply treated as a reserved name.
- Usage hints updated: `usage: plugins enable <name|all>` /
  `usage: plugins disable <name|all>`.
- Implemented via new `enable_all()` and `disable_all()` helpers in
  `plugins/plugins.v`.

**SSH hostname tab completion plugin (`examples/ssh_hosts.v`)**
- New example plugin that provides tab completion for the `ssh` command.
- Reads `~/.ssh/config` (explicit `Host` entries; wildcards skipped) and
  `~/.ssh/known_hosts` (skips hashed `|1|` entries; handles `[host]:port`
  bracket notation).
- Supports `user@<prefix>` notation — the `user@` part is preserved in the
  returned completions.
- Install: `cp examples/ssh_hosts.v ~/.vlsh/plugins/ssh_hosts.v && plugins reload`

**Plugin completion protocol**
- New `completion` capability: plugins that declare it are called with
  `complete <input>` on every Tab press and may print one full replacement
  string per line.
- `has_completion bool` added to the `Plugin` struct; parsed in `plugins.load()`.
- `completions(input string) []string` added to `plugins/plugins.v`; spawns
  each capable plugin and collects its output.
- `set_loaded([]Plugin)` / `g_loaded` added to `plugins/plugins.v` so the
  module-level completion dispatcher can be called from `tab_complete()`, which
  has a fixed `fn(string) []string` signature.
- `tab_complete()` in `vlsh.v` consults plugins first; falls back to built-in
  file/directory completion when plugins return nothing.

### Bugs fixed

**`cd` tab completion now shows only directories**
- Pressing Tab after `cd ` no longer suggests plain files; only directory names
  (with a trailing `/`) are offered.

**User-friendly error when `cd`-ing into a file**
- Attempting `cd somefile` now prints `somefile: not a directory` instead of
  the cryptic `could not change directory to somefile: fn () string`.
- `${err.msg}` (method reference) replaced with `${err}` (calls `msg()`) in
  the fallback `os.chdir` error path.

---

## 2026-02-19 — version 1.0.5

### Bugs fixed

**Glob patterns not expanded (e.g. `mv ./*.deb builds/`)**
- Unquoted tokens containing `*` or `?` are now expanded against the
  filesystem before being passed to a command.
- Implemented in `parse_args()` in `utils/utils.v`: a `has_quoted` flag
  tracks whether any character in the current token was inside quotes; when
  flushing a token, unquoted wildcard tokens are passed through the new
  `glob_expand()` helper which calls `os.glob()` and substitutes the sorted
  match list (or leaves the literal intact if nothing matches).
- Quoted wildcards (e.g. `"*.v"`) are never expanded.
- Tilde is expanded before globbing so patterns like `~/dir/*.txt` work.

### Changes

**`build_deb.sh` outputs packages into `builds/`**
- The script now creates a `builds/` directory and moves the finished
  `.deb` file there, so packages no longer accumulate in the repo root.

---

## 2026-02-19 — version 1.0.4

### Bugs fixed

**Ctrl+C while running a command closed vlsh**
- Pressing Ctrl+C during an external command (e.g. `grep -R … ~/`) now stops
  only that command and returns to the prompt; vlsh no longer exits.
- Root cause: the kernel sends SIGINT to the entire foreground process group,
  which included vlsh itself (default disposition: terminate).
- Fix in `exec/exec.v` (`run()`): immediately after `child.run()` (the fork),
  the parent sets `SIGINT` to `SIG_IGN`. The child already inherited `SIG_DFL`
  at fork time and therefore still dies normally on Ctrl+C. After
  `child.wait()` the parent restores `SIG_DFL` for the next prompt cycle.
- Covers all execution paths: plain commands, pipes, output redirection, and
  piped-with-stdin chains.

### Features added

**`vman` plugin — V module documentation pager**
- New example plugin `examples/v_man.v` adds the `vman <module>` command.
- Fetches `https://modules.vlang.io/<module>.html`, converts the HTML to
  ANSI-formatted text, and pages the result through `less -R` (or `more`).
- Headings are bold/underlined, inline code is cyan, `<pre>` blocks are
  preserved verbatim; `<script>`, `<style>` and `<noscript>` subtrees are
  stripped entirely.
- Install: `cp examples/v_man.v ~/.vlsh/plugins/v_man.v && plugins reload`

**Plugin documentation in README**
- New `### Plugins` section under `## DOCUMENTATION` explains the plugin
  protocol, managing plugins, and describes all three example plugins
  (`hello_plugin.v`, `git.v`, `v_man.v`).

---

## 2026-02-19 — version 1.0.3

### Changes

**Git prompt moved to a plugin**
- Git branch/commit display has been removed from the main shell binary and
  extracted into a standalone plugin (`examples/git.v`).
- To restore git prompt display, copy `examples/git.v` to
  `~/.vlsh/plugins/git.v`; vlsh will compile and load it automatically on the
  next start (requires `v` in PATH).
- The plugin reads `style_git_bg` / `style_git_fg` colours from `~/.vlshrc`
  (defaults: `44,59,71` / `251,255,234`) and outputs a 24-bit ANSI-coloured
  `branch commit` label above the prompt, identical to the previous built-in
  behaviour.
- `Prompt` struct, `update_git_info()`, and `fully_reset()` removed from
  `vlsh.v`; `pre_prompt()` now only returns the bold current-directory line.

---

## 2026-02-19 — version 1.0.2

### Features added

**Mouse text selection in mux mode**
- Holding the left mouse button and dragging now marks text inside a pane;
  the selection is highlighted with reverse video.
- Double-clicking selects the word under the cursor.
- Middle-click pastes the current selection at the cursor position in the
  active pane (standard X11 behaviour).
- Upgraded mouse protocol from X10 (`?1000h`) to SGR button-event tracking
  (`?1002h` + `?1006h`) so the terminal reports press, release and drag events
  with full coordinate range.
- Selection state (`sel_active`, `sel_pane_id`, start/end col/row, clipboard)
  added to `Mux`; new handlers `do_mouse_left_press`, `do_mouse_motion`,
  `do_mouse_left_release`, `do_middle_paste`; helpers `extract_selection_text`
  and `word_boundaries` added to `mux/mux.v`.
- `render_pane_sb` in `mux/render.v` now emits `\x1b[7m` (reverse video) for
  selected cells.

**Mux status bar**
- A 1-row status bar is now displayed at the top of the terminal in mux mode.
- Shows `vlsh mux` on the left and the live pane count on the right.
- Default background colour: `#2c7c43` (configurable via
  `style set style_mux_bar_bg R G B`).
- All panes are shifted down by one row to make room; `style_mux_bar_bg`
  added to the style defaults in `cfg/cfg.v`.

### Bugs fixed

**Editors (vim, nano, …) corrupted in mux panes**
- The VT100 emulator in `mux/pane.v` was missing several sequences that
  every full-screen editor relies on. Added:
  - `CSI r` (DECSTBM) — scroll region; `\n` and line-wrap now respect it.
  - `ESC M` — Reverse Index: move cursor up / scroll region down.
  - `ESC 7` / `ESC 8` and `CSI s` / `CSI u` — cursor save/restore (DECSC/DECRC).
  - `CSI ?1049h` / `CSI ?1049l` — alternate screen buffer (used by vim/nano
    on entry and exit).
  - `CSI L` / `CSI M` — Insert Line / Delete Line.
  - `CSI P` — Delete Character.
  - `CSI S` / `CSI T` — Scroll Up / Scroll Down.
  - `CSI X` — Erase Character.
  - `scroll_down()` added to support Reverse Index and `CSI T`.

**Ctrl+C exits vlsh instead of clearing the input line**
- Pressing `Ctrl+C` at the shell prompt previously mapped to `.eof` which
  exited the shell.
- Now mapped to a new `cancel_line` action: prints `^C`, clears the current
  input, and causes `vlsh_read_line` to return `error('cancelled')`.
- `main()` in `vlsh.v` catches `'cancelled'` and continues the prompt loop
  instead of exiting.

---

## 2026-02-19 14:00 UTC

### Bugs fixed

**Backspace at column 0 deletes nothing (bug 16b)**
- Pressing Backspace (`\x7f`) while the cursor is at position 0 on a non-empty
  line now deletes the first character (forward-delete), instead of silently
  doing nothing.
- Root cause: `vlib/readline` `delete_character()` returns early when
  `cursor <= 0`. Fix implemented without modifying vlib by replacing the
  `r.read_line()` call with `vlsh_read_line()` — a custom readline loop defined
  in `readline_fix.v` that uses only the public Readline API
  (`enable_raw_mode`, `disable_raw_mode`, `read_char`, `pub mut` fields).

**END key inserts tilde (bug 16)**
- Pressing the End key on terminals that send `\x1b[4~` (VT220/rxvt) no longer
  inserts a literal `~`; it now moves the cursor to end of line.
- Fixed as part of the custom readline loop: `vlsh_analyse_escape()` in
  `readline_fix.v` now handles `\x1b[4~` → `move_cursor_end`, consuming the
  full 4-byte sequence. The standard `\x1b[F` (xterm/VTE) sequence was already
  handled correctly.

---

## 2026-02-19 12:30 UTC

### Features added

**Native `.vsh` script support**
- `.vsh` files are now executed automatically via `v run` without any extra syntax.
- Works for absolute paths (`/path/to/script.vsh`), explicit relative paths (`./script.vsh`,
  `../script.vsh`), tilde paths (`~/bin/script.vsh`), bare filenames (`script.vsh` — resolved
  against the current directory), and `.vsh` files found during normal PATH search.
- `use_v_run()` added to `exec/exec.v`: rewrites the command to `v run <vsh_path> [args…]`.
- `find_v_exe()` added to `exec/exec.v`: searches vlsh-configured paths then system `PATH`
  for the `v` binary.
- Relative path execution (`./foo`, `../foo`) was previously broken in `find_exe()`; fixed
  as part of this change.
- New tests added to `exec/exec_test.v`: `find_v_exe`, `use_v_run` (fullcmd + args
  preservation), and absolute-path resolution.
- `README.md` updated with a `.vsh scripts` section under Shell features.

---

## 2026-02-19 11:41 UTC

### Bugs fixed

**Tilde expansion (bugs 1–2)**
- `~` and `~/path` are now expanded to `$HOME` in all command arguments and in
  the command name itself (e.g. `vi ~/.config/nvim/init.vim`, `more ~/.vlshrc`).
- `expand_tilde()` added to `exec/exec.v`; applied in `find_exe()` and when
  setting child-process arguments.

**Output redirection (bugs 3–5)**
- `>` (truncate) and `>>` (append) are now supported for external commands and
  for the built-in `echo`.
- `parse_redirect()` added to `exec/exec.v`; strips redirection tokens from the
  argument list and captures the target filename and mode.
- `builtin_redirect()` and `write_redirect()` added to `vlsh.v` for built-ins.

**UTF-8 / multibyte characters in mux (bugs 6–7)**
- Multi-byte UTF-8 sequences (e.g. Swedish å, ä, ö) are now decoded correctly
  in PTY output inside the multiplexer.
- `utf8_buf` / `utf8_rem` state added to `Pane`; `utf8_seq_len()` and
  `utf8_buf_to_rune()` helpers added to `mux/pane.v`.

**AND-chains (bug 8)**
- `cmd1 && cmd2 && cmd3` syntax is now supported; the chain stops on the first
  non-zero exit code.
- `split_and_chain()` added to `vlsh.v`; `main_loop` now returns an `int` exit
  code so the chain logic can propagate failures correctly.

**Documentation (bug 9)**
- Full `## DOCUMENTATION` section added to `README.md` covering architecture
  overview, config file format, all built-in commands, shell features (pipes,
  redirection, &&, tilde, env-var prefix, history, tab completion, plugins),
  multiplexer key bindings, and module API summary.

**Mouse support in mux (bug 10)**
- Clicking a pane now makes it active.
- X10 mouse tracking (`\x1b[?1000h`) enabled on mux entry; disabled on exit.
- `do_mouse_click()` added to `mux/mux.v`; `InputHandler` extended with
  `click_col` / `click_row` fields and X10 packet parsing.

**Mux exit message (bug 11)**
- "Exited mux mode" is now printed to the terminal after the multiplexer
  restores the terminal state.

**CTRL+V + o cycles panes (bug 12)**
- `Ctrl+V` + `o` now cycles focus to the next alive pane.
- `do_cycle()` added to `mux/mux.v`; `cycle_pane` action added to
  `MuxAction` enum and `InputHandler`.

**Removed CTRL+V + x (bug 13)**
- The `x` key binding (close pane) has been removed from the prefix map.
  Panes still close automatically when their process exits.

**nvim slow to exit in mux (bug 14)**
- Multiplexer `select` timeout reduced from 50 ms to 5 ms so the PTY write
  buffer drains quickly.
- `do_close()` now tries a non-blocking `waitpid(WNOHANG)` first and only
  sends `SIGTERM` + blocks if the process is still running.

**Background colour erase in mux (bug 15)**
- Erased cells now carry the current SGR (background colour) so that
  applications using BCE (Background Color Erase) — such as nvim — render
  their colour schemes correctly.
- All `J` and `K` erase sequences and `scroll_up()` in `mux/pane.v` now
  use `Cell{ch: ' ', sgr: p.cur_sgr}` for blank cells.

**Global shared command history (bug 17)**
- All shell instances now share a single history file at `~/.vlsh_history`
  (last 5000 entries).
- `load_history()` populates readline's `previous_lines` on startup;
  `append_history()` appends each command and trims the file when it exceeds
  5000 lines.

**VAR=value command prefix (bug 18)**
- Leading `KEY=VALUE` tokens before a command are now detected and temporarily
  set as environment variables for the duration of that command only, then
  unset (e.g. `FIELD_LIST='used,avail' df -h --no-sync .`).
- `is_env_assign()` added to `utils/utils.v`; `main_loop` in `vlsh.v`
  refactored to strip the prefix tokens, set/unset around `dispatch_cmd()`.

**venv command (bug 19)**
- New built-in `venv` manages session-scoped environment variables:
  - `venv add <NAME> <value>` — set a variable for the current session
  - `venv rm <NAME>`          — unset it
  - `venv list`               — list all venv-managed variables and their values
- Tracked variable names are stored in `__VLSH_VENV` (a colon-separated env
  var) so no global state is required.

**Test suite (bug 20)**
- All 7 test suites now pass with 0 failures.
- Fixed stale `input_test.v` test (`x` → `.close_pane` replaced with
  `x` → `.passthrough`).
- New tests added:
  - `mux/input_test.v`   — `o` → `.cycle_pane`, X10 mouse click/release
  - `utils/utils_test.v` — 14 tests for `is_env_assign`
  - `exec/exec_test.v`   — 11 tests for `expand_tilde` and `parse_redirect`
  - `mux/pane_test.v`    — 10 tests for `utf8_seq_len`, `utf8_buf_to_rune`,
                            and multi-byte `feed`
  - `vlsh_test.v`        — 8 tests for `split_and_chain`; 6 tests for
                            `venv_tracked`, `venv_track`, `venv_untrack`

### Not fixed in this session

- (none — bugs 16 and 16b were fixed in the 2026-02-19 14:00 UTC entry above)
